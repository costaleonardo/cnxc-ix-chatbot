<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Tooltip Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            color: #2563eb;
            font-size: 24px;
        }

        .info-box {
            background: #f0f9ff;
            border: 2px solid #2563eb;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .test-section {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .test-section h2 {
            margin-top: 0;
            font-size: 18px;
            color: #0f172a;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .checklist li:before {
            content: "‚òê ";
            font-size: 18px;
            margin-right: 8px;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin: 4px 0;
        }

        .status.pass {
            background: #dcfce7;
            color: #166534;
        }

        .status.fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .device-info {
            background: #fef3c7;
            padding: 12px;
            border-radius: 4px;
            margin: 12px 0;
            font-size: 14px;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>Mobile Tooltip Fix Test</h1>

    <div class="info-box">
        <strong>Test Status:</strong> Ready for Testing<br>
        <strong>Date:</strong> <span id="test-date"></span><br>
        <strong>Device Type:</strong> <span id="device-type"></span>
    </div>

    <div class="device-info" id="device-detection">
        Detecting device capabilities...
    </div>

    <div class="test-section">
        <h2>Changes Made</h2>
        <ul>
            <li>‚úÖ Added <code>detectTouchDevice()</code> method to detect touch-capable devices</li>
            <li>‚úÖ Added <code>hideAllTooltips()</code> helper method</li>
            <li>‚úÖ Added <code>toggleTooltip(type)</code> method for mobile tooltip control</li>
            <li>‚úÖ Updated event listeners to use click events on touch devices instead of hover</li>
            <li>‚úÖ Added document-level click handler to close tooltips when tapping outside</li>
            <li>‚úÖ Added tooltip hiding to button action handlers (minimize, refresh, back)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test Plan - Mobile Devices</h2>
        <ul class="checklist">
            <li>Open chatbot widget on mobile device (iOS Safari or Android Chrome)</li>
            <li>Tap the info button (‚ÑπÔ∏è) - tooltip should appear</li>
            <li>Tap the info button again - tooltip should disappear</li>
            <li>Tap the info button to show tooltip, then tap anywhere outside - tooltip should disappear</li>
            <li>Tap refresh button (üîÑ) - tooltip should appear</li>
            <li>Tap refresh button again - tooltip should disappear</li>
            <li>Tap minimize button (‚àí) - tooltip should appear</li>
            <li>Tap minimize button again - tooltip should disappear</li>
            <li>Tap back button (‚Üê) in chat view - tooltip should appear</li>
            <li>Tap back button again - tooltip should disappear</li>
            <li>Show any tooltip, then tap a different button - first tooltip should hide, new one should show</li>
            <li>Click actual button (not just wrapper) - tooltip should hide AND action should execute</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test Plan - Desktop Devices</h2>
        <ul class="checklist">
            <li>Open chatbot widget on desktop (Chrome, Firefox, Safari)</li>
            <li>Hover over info button - tooltip should appear</li>
            <li>Move mouse away from info button - tooltip should disappear</li>
            <li>Hover over refresh button - tooltip should appear</li>
            <li>Move mouse away - tooltip should disappear</li>
            <li>Hover over minimize button - tooltip should appear</li>
            <li>Move mouse away - tooltip should disappear</li>
            <li>Hover over back button - tooltip should appear</li>
            <li>Move mouse away - tooltip should disappear</li>
            <li>Verify no click-to-toggle behavior on desktop (should be hover-only)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Expected Behavior Summary</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid #e2e8f0;">
                <th style="text-align: left; padding: 8px;">Device Type</th>
                <th style="text-align: left; padding: 8px;">Tooltip Show</th>
                <th style="text-align: left; padding: 8px;">Tooltip Hide</th>
            </tr>
            <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 8px;"><strong>Mobile/Touch</strong></td>
                <td style="padding: 8px;">Click wrapper/button</td>
                <td style="padding: 8px;">Click again, tap outside, or perform action</td>
            </tr>
            <tr>
                <td style="padding: 8px;"><strong>Desktop/Mouse</strong></td>
                <td style="padding: 8px;">Hover over wrapper</td>
                <td style="padding: 8px;">Mouse leave wrapper</td>
            </tr>
        </table>
    </div>

    <div class="test-section">
        <h2>Known Issues Fixed</h2>
        <ul>
            <li>‚ùå <strong>Before:</strong> Tooltips stayed visible after tapping on mobile</li>
            <li>‚úÖ <strong>After:</strong> Tooltips can be dismissed by tapping again or tapping outside</li>
            <li>‚ùå <strong>Before:</strong> Only <code>mouseenter</code>/<code>mouseleave</code> events (don't work on touch)</li>
            <li>‚úÖ <strong>After:</strong> Touch devices use click events, desktop uses hover events</li>
            <li>‚ùå <strong>Before:</strong> No way to close tooltip except closing widget</li>
            <li>‚úÖ <strong>After:</strong> Multiple ways to dismiss: toggle, tap outside, or perform action</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Files Modified</h2>
        <ul>
            <li><code>assets/js/chatbot.js</code> - Added touch detection and mobile-specific event handlers</li>
        </ul>
    </div>

    <script>
        // Display current date
        document.getElementById('test-date').textContent = new Date().toLocaleDateString();

        // Detect device type using same logic as chatbot
        function detectTouchDevice() {
            return ('ontouchstart' in window) ||
                   (navigator.maxTouchPoints > 0) ||
                   (navigator.msMaxTouchPoints > 0);
        }

        const isTouchDevice = detectTouchDevice();
        const deviceType = isTouchDevice ? 'Touch Device (Mobile/Tablet)' : 'Non-Touch Device (Desktop)';
        document.getElementById('device-type').textContent = deviceType;

        // Display detailed device info
        const deviceInfo = document.getElementById('device-detection');
        deviceInfo.innerHTML = `
            <strong>Device Detection Results:</strong><br>
            <code>ontouchstart in window</code>: ${'ontouchstart' in window}<br>
            <code>navigator.maxTouchPoints</code>: ${navigator.maxTouchPoints}<br>
            <code>navigator.msMaxTouchPoints</code>: ${navigator.msMaxTouchPoints || 'undefined'}<br>
            <strong>Is Touch Device:</strong> ${isTouchDevice ? 'YES' : 'NO'}<br>
            <strong>Expected Behavior:</strong> ${isTouchDevice ? 'Click to toggle tooltips' : 'Hover to show tooltips'}
        `;

        // Add interactive checkbox functionality
        document.querySelectorAll('.checklist li').forEach(item => {
            item.style.cursor = 'pointer';
            item.addEventListener('click', function() {
                if (this.style.textDecoration === 'line-through') {
                    this.style.textDecoration = 'none';
                    this.style.opacity = '1';
                    this.querySelector('::before') || (this.innerHTML = this.innerHTML.replace('‚òë', '‚òê'));
                } else {
                    this.style.textDecoration = 'line-through';
                    this.style.opacity = '0.6';
                    this.innerHTML = this.innerHTML.replace('‚òê', '‚òë');
                }
            });
        });
    </script>
</body>
</html>
