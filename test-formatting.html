<!DOCTYPE html>
<html>
<head>
    <title>Test Paragraph Formatting</title>
    <link rel="stylesheet" href="assets/css/chatbot.css">
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .test-case { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .test-case h3 { margin-top: 0; color: #333; }
        .before { background: #ffe6e6; }
        .after { background: #e6ffe6; }
        .chatbot-message-text { 
            background: white; 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #ddd; 
            max-width: 400px;
        }
    </style>
</head>
<body>
    <h1>Paragraph Formatting Test</h1>
    
    <div class="test-case">
        <h3>Test 1: Single Paragraph</h3>
        <div class="chatbot-message-text">
            <p>This is a single paragraph that should have no bottom margin since it's the last child.</p>
        </div>
    </div>
    
    <div class="test-case">
        <h3>Test 2: Multiple Paragraphs</h3>
        <div class="chatbot-message-text">
            <p>This is the first paragraph. It should have a bottom margin.</p>
            <p>This is the second paragraph. It should also have a bottom margin.</p>
            <p>This is the final paragraph. It should have no bottom margin since it's the last child.</p>
        </div>
    </div>
    
    <div class="test-case">
        <h3>Test 3: Paragraph with Headers</h3>
        <div class="chatbot-message-text">
            <p>This is a paragraph before a header.</p>
            <h3>This is a Header</h3>
            <p>This is a paragraph after a header and should be properly spaced.</p>
        </div>
    </div>
    
    <div class="test-case">
        <h3>Test 4: Paragraph with Lists</h3>
        <div class="chatbot-message-text">
            <p>Here are some items:</p>
            <ul>
                <li>First item</li>
                <li>Second item</li>
            </ul>
            <p>This paragraph follows the list.</p>
        </div>
    </div>

    <script>
        // Simulate the formatMessage function to test our logic
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function testFormatMessage(content) {
            let processedContent = content;
            
            // Simplified version of the actual formatMessage logic
            const paragraphs = processedContent.split(/\n\n+/).filter(p => p.trim().length > 0);
            
            if (paragraphs.length > 1) {
                processedContent = paragraphs.map(paragraph => {
                    const cleanParagraph = paragraph.replace(/\n/g, ' ').trim();
                    return cleanParagraph ? `<p>${cleanParagraph}</p>` : '';
                }).filter(p => p.length > 0).join('');
            } else if (paragraphs.length === 1) {
                const hasBlockElements = /<(h[1-6]|ul|ol|pre|blockquote|div)>/i.test(processedContent);
                if (!hasBlockElements) {
                    const cleanContent = processedContent.replace(/\n/g, ' ').trim();
                    processedContent = cleanContent ? `<p>${cleanContent}</p>` : '';
                } else {
                    processedContent = processedContent.replace(/\n/g, ' ');
                }
            }
            
            return processedContent;
        }
        
        // Test cases
        console.log('=== Formatting Tests ===');
        
        // Test 1: Single line
        console.log('Test 1:', testFormatMessage('Hello world'));
        
        // Test 2: Multiple paragraphs
        console.log('Test 2:', testFormatMessage('First paragraph.\n\nSecond paragraph.\n\nThird paragraph.'));
        
        // Test 3: Single paragraph with line break
        console.log('Test 3:', testFormatMessage('Line one\nLine two'));
        
        console.log('Check the browser console for test results');
    </script>
</body>
</html>